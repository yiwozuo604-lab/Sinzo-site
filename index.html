<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>bord</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ====== ã‚ãŠã‚ãŠãŒä½¿ã£ã¦ãŸå…ƒã®è¦‹ãŸç›®ã‚’å®Œå…¨ç¶­æŒ ====== */
body {
  font-family: sans-serif;
  background-color: #e6f0ff;
  margin: 0;
  padding: 0;
  text-align: center;
}

button {
  padding: 10px 20px;
  margin: 5px;
  cursor: pointer;
  border-radius: 20px;
  border: none;
  font-size: 16px;
}

.greenBtn {
  background-color: #27ae60;
  color: white;
}

.redBtn {
  background-color: #c0392b;
  color: white;
}

ul, ol {
  list-style: none;
  padding: 0;
  text-align: left;
}

li {
  padding: 10px;
  border-radius: 10px;
  margin-bottom: 10px;
  color: white;
  position: relative;
  word-wrap: break-word;
}

/* â–¼ ä¸¦ã³æ›¿ãˆè¿½åŠ ï¼ˆæ—¢å­˜ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å´©ã•ãªã„ï¼‰ */
#sortSelect {
  width: 230px;
  padding: 8px;
  border-radius: 8px;
  margin: 10px auto 20px;
  display: block;
}

/* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
#overlay {
  position: fixed;
  display: none;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
}

#popupForm {
  display: none;
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 15px;
  width: 300px;
  border-radius: 10px;
}

/* ç”»åƒãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
#imagePopup {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  text-align: center;
}

#popupImage {
  max-width: 90%;
  max-height: 90%;
  margin-top: 5%;
}
</style>

</head>

<body>

<h1>bord</h1>

<button id="adminBtn" class="redBtn" style="position:fixed; top:10px; left:10px;">
  ç®¡ç†è€…æ“ä½œ
</button>

<!-- â–¼ ä¸¦ã³æ›¿ãˆã‚»ãƒ¬ã‚¯ãƒˆ -->
<select id="sortSelect">
  <option value="created_desc">ä½œæˆæ—¥ï¼ˆæ–°ã—ã„é †ï¼‰</option>
  <option value="created_asc">ä½œæˆæ—¥ï¼ˆå¤ã„é †ï¼‰</option>
  <option value="lastpost_desc">æœ€æ–°æŠ•ç¨¿é †</option>
  <option value="likes_desc">é«˜è©•ä¾¡é †</option>
  <option value="dislikes_desc">ä½è©•ä¾¡é †</option>
</select>

<!-- ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§ -->
<div id="threadListSection">
  <ul id="threadList"></ul>
  <div id="pagination"></div>

  <button id="createThreadBtn" class="greenBtn"
    style="position:fixed; bottom:70px; right:20px;">
    æ–°è¦ã‚¹ãƒ¬ãƒƒãƒ‰
  </button>
</div>

<!-- ã‚¹ãƒ¬ãƒƒãƒ‰è©³ç´° -->
<div id="threadDetailSection" style="display:none;">
  <h3 id="threadTitle"></h3>
  <small id="threadDetail"></small>
  <small id="threadCreator"></small>

  <ol id="postList"></ol>

  <button id="createPostBtn" class="greenBtn"
    style="position:fixed; bottom:70px; right:20px;">
    æŠ•ç¨¿
  </button>

  <button id="closeThreadBtn" class="greenBtn"
    style="position:fixed; bottom:70px; left:20px;">
    æˆ»ã‚‹
  </button>
</div>

<!-- â–¼ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
<div id="overlay"></div>
<div id="popupForm">
  <h3 id="popupTitle"></h3>

  <div id="threadFields">
    <label>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label>
    <input id="threadMemberId">

    <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
    <input id="threadTitleInput">

    <label>è©³ç´°</label>
    <textarea id="threadDetailInput"></textarea>

    <label>èƒŒæ™¯è‰²</label>
    <select id="threadColorInput">
      <option value="#3498db">é’</option>
      <option value="#2ecc71">ç·‘</option>
      <option value="#e74c3c">èµ¤</option>
    </select>

    <label>ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰</label>
    <input id="threadPasswordInput">

    <label>ç”»åƒï¼ˆä»»æ„ï¼‰</label>
    <input type="file" id="threadImageInput" accept="image/*">
  </div>

  <div id="postFields" style="display:none;">
    <label>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label>
    <input id="postMemberId">

    <label>æœ¬æ–‡</label>
    <textarea id="postBodyInput"></textarea>

    <label>èƒŒæ™¯è‰²</label>
    <select id="postColorInput">
      <option value="#3498db">é’</option>
      <option value="#2ecc71">ç·‘</option>
      <option value="#e74c3c">èµ¤</option>
    </select>

    <label>ç”»åƒï¼ˆä»»æ„ï¼‰</label>
    <input type="file" id="postImageInput" accept="image/*">
  </div>

  <div id="adminFields" style="display:none;">
    <label>ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
    <input id="adminPasswordInput" type="password">

    <label><input type="radio" name="adminAction" value="single" checked> ã‚¹ãƒ¬å‰Šé™¤</label>
    <label><input type="radio" name="adminAction" value="post"> æŠ•ç¨¿å‰Šé™¤</label>
    <label><input type="radio" name="adminAction" value="all"> å…¨å‰Šé™¤</label>

    <select id="adminThreadSelect"></select>
    <select id="adminPostSelect"></select>
  </div>

  <div id="passwordFields" style="display:none;">
    <label>ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
    <input id="threadPasswordCheckInput" type="password">
  </div>

  <button id="submitBtn" class="greenBtn">é€ä¿¡</button>
  <button id="closePopupBtn" class="greenBtn">é–‰ã˜ã‚‹</button>
</div>

<!-- ç”»åƒãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
<div id="imagePopup">
  <img id="popupImage">
  <button id="closeImagePopup" class="greenBtn" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
</div>

<!-- â–¼â–¼â–¼ ã“ã®ä¸‹ã« Part2ï¼ˆJavaScriptå…¨éƒ¨ï¼‰ ã‚’è²¼ã‚Œã°å®Œæˆï¼ â–¼â–¼â–¼ -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { 
  getFirestore, collection, addDoc, query, orderBy, onSnapshot, Timestamp,
  getDocs, doc, deleteDoc, updateDoc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* Firebaseè¨­å®š */
const firebaseConfig = {
  apiKey: "AIzaSyC9ygh6HJX5mK1e5ZBnEWnLQCEjRMKIEWA",
  authDomain: "sinzo-3f972.firebaseapp.com",
  projectId: "sinzo-3f972",
  storageBucket: "sinzo-3f972.firebasestorage.app",
  messagingSenderId: "1058985227031",
  appId: "1:1058985227031:web:2e3a31346805442e10bd52"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ */
const ADMIN_PASSWORD = "2059";

/* NGãƒ¯ãƒ¼ãƒ‰ */
const NG_WORDS = [
  "æ­»ã­","æ®ºã™","ã¶ã£æ®ºã™","æ­»ã‚“ã§","åœ°ç„",
  "ã‚»ãƒƒã‚¯ã‚¹","ã‚¨ãƒ­","ã‚¢ãƒ€ãƒ«ãƒˆ","ã‚ã„ã›ã¤","è£¸","ä¸‹ç€","æ·«ã‚‰","å‘çŒ¥","ãƒŒãƒ¼ãƒ‰",
  "å¤‰æ…‹","æ€§äº¤","æ´åŠ©äº¤éš›","ä¸­å‡ºã—","ã‚ªãƒŠãƒ‹ãƒ¼","ãƒ‘ã‚¤ãƒ‘ãƒ³","ä¹±äº¤","ãƒ­ãƒª","ã‚·ãƒ§ã‚¿"
];

function containsNGWord(text){
  if(!text) return false;
  return NG_WORDS.some(w => text.includes(w));
}

/* Cookie */
function getCookie(name){
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  return parts.length === 2 ? parts.pop().split(";")[0] : null;
}

function setCookie(name, value, days=365){
  const d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  document.cookie = `${name}=${value}; expires=${d.toUTCString()}; path=/`;
}

/* ã„ã„ã­ã‚¯ãƒƒã‚­ãƒ¼ */
function setRateCookie(id, type){
  setCookie(`rate_${id}`, type);
}
function getRateCookie(id){
  return getCookie(`rate_${id}`);
}

/* åŸºæœ¬å¤‰æ•° */
let nickName = getCookie("nickName") || "åç§°æœªè¨­å®š";
let iconBase64 = sessionStorage.getItem("icon") || null;

let currentThreadId = null;
let threadsData = [];
let postsUnsub = null;

let currentPage = 1;
const pageSize = 10;

/* ä¸¦ã³æ›¿ãˆ */
let currentSort = "created_desc";
document.getElementById("sortSelect").onchange = e => {
  currentSort = e.target.value;
  sortThreads();
  renderThreadsPage();
};

/* æ—¥ä»˜ç³» */
function formatDate(ts){
  if(!ts) return "";
  const d = ts.toDate ? ts.toDate() : new Date(ts);
  return `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}
          ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}

function formatRelativeTime(ts){
  if(!ts) return "";
  const d = ts.toDate ? ts.toDate() : new Date(ts);
  const now = new Date();
  const diff = now - d;

  const sec = Math.floor(diff / 1000);
  const min = Math.floor(sec / 60);
  const hour = Math.floor(min / 60);
  const day = Math.floor(hour / 24);

  const base = formatDate(ts);
  if(day > 0) return `${base} (${day}æ—¥å‰)`;
  if(hour > 0) return `${base} (${hour}æ™‚é–“å‰)`;
  if(min > 0) return `${base} (${min}åˆ†å‰)`;
  return `${base} (ãŸã£ãŸä»Š)`;
}

/* ä¸¦ã³æ›¿ãˆå‡¦ç† */
function sortThreads(){
  threadsData.sort((a,b)=>{
    const A=a.data(); const B=b.data();

    if(currentSort==="created_desc")
      return B.created_at.seconds - A.created_at.seconds;

    if(currentSort==="created_asc")
      return A.created_at.seconds - B.created_at.seconds;

    if(currentSort==="likes_desc")
      return (B.likes||0) - (A.likes||0);

    if(currentSort==="dislikes_desc")
      return (B.dislikes||0) - (A.dislikes||0);

    if(currentSort==="lastpost_desc"){
      const la = A.lastPost_at ? A.lastPost_at.seconds : 0;
      const lb = B.lastPost_at ? B.lastPost_at.seconds : 0;
      return lb - la;
    }

    return 0;
  });
}

/* ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§æç”» */
function renderThreadsPage(){
  const list = document.getElementById("threadList");
  list.innerHTML = "";

  const start = (currentPage-1) * pageSize;
  const items = threadsData.slice(start, start+pageSize);

  if(items.length === 0){
    list.innerHTML = "<li>ã¾ã ã‚ã‚Šã¾ã›ã‚“</li>";
    return;
  }

  items.forEach(docItem=>{
    const data = docItem.data();

    const li = document.createElement("li");
    li.style.backgroundColor = data.color;

    let titleText = data.title;
    if(data.locked) titleText = "ğŸ”’" + titleText;
    if(data.password) titleText += " ğŸ”‘";

    li.innerHTML = `
      <strong>${titleText}</strong>
      <small>æŠ•ç¨¿æ•°: ${data.postCount || 0}</small>
      <small>${data.detail || ""}</small>
    `;

    /* è©•ä¾¡ãƒœã‚¿ãƒ³ */
    const box = document.createElement("div");
    box.className = "threadRateBox";

    const likeBtn = document.createElement("button");
    likeBtn.className = "threadRateBtn";
    likeBtn.innerHTML = `ğŸ‘ <span class="threadRateCount">${data.likes||0}</span>`;

    const disBtn = document.createElement("button");
    disBtn.className = "threadRateBtn";
    disBtn.innerHTML = `ğŸ‘ <span class="threadRateCount">${data.dislikes||0}</span>`;

    box.appendChild(likeBtn);
    box.appendChild(disBtn);
    li.appendChild(box);

    /* ç”»åƒè¡¨ç¤ºãƒœã‚¿ãƒ³ */
    if(data.image){
      const imgBtn = document.createElement("button");
      imgBtn.className = "greenBtn";
      imgBtn.textContent = "ç”»åƒã‚’è¡¨ç¤º";
      imgBtn.onclick = e => {
        e.stopPropagation();
        showImagePopup(data.image);
      };
      li.appendChild(imgBtn);
    }

    /* ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ãƒ¬ãƒƒãƒ‰ã¸ */
    li.onclick = ()=> tryOpenThread(docItem.id, data);

    /* ã„ã„ã­ */
    likeBtn.onclick = async e => {
      e.stopPropagation();
      if(getRateCookie(docItem.id)) return alert("1å›ã ã‘æŠ¼ã›ã¾ã™ï¼");
      await updateDoc(doc(db,"threads",docItem.id),{
        likes: (data.likes||0)+1
      });
      setRateCookie(docItem.id,"like");
    };

    /* ä½è©•ä¾¡ */
    disBtn.onclick = async e => {
      e.stopPropagation();
      if(getRateCookie(docItem.id)) return alert("1å›ã ã‘æŠ¼ã›ã¾ã™ï¼");
      await updateDoc(doc(db,"threads",docItem.id),{
        dislikes: (data.dislikes||0)+1
      });
      setRateCookie(docItem.id,"dislike");
    };

    list.appendChild(li);
  });

  const totalPages = Math.max(1, Math.ceil(threadsData.length / pageSize));
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  for(let i=1; i<=totalPages; i++){
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.className = "pageBtn";
    if(i===currentPage) btn.disabled = true;
    btn.onclick = ()=>{ currentPage=i; renderThreadsPage(); };
    pagination.appendChild(btn);
  }
}

/* Firestoreç›£è¦– */
async function listenThreads(){
  onSnapshot(collection(db,"threads"), async snap=>{
    const arr = await Promise.all(snap.docs.map(async d=>{
      const data = d.data();

      const posts = await getDocs(collection(db,"threads",d.id,"posts"));
      data.postCount = posts.size;

      if(data.likes===undefined) data.likes=0;
      if(data.dislikes===undefined) data.dislikes=0;

      return { id:d.id, data:()=>data };
    }));

    threadsData = arr;
    sortThreads();
    renderThreadsPage();
  });
}

/* ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é–‹ã */
async function tryOpenThread(id, data){
  if(data.password){
    showForm("passwordFields");
    document.getElementById("popupTitle").textContent="ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰";
    document.getElementById("submitBtn").onclick = ()=>{
      const val = document.getElementById("threadPasswordCheckInput").value;
      if(val === data.password){
        closePopup();
        openThread(id,data);
      } else {
        alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
      }
    };
  } else {
    openThread(id,data);
  }
}

function openThread(id, data){
  currentThreadId = id;

  document.getElementById("threadTitle").textContent = data.title;
  document.getElementById("threadDetail").textContent = data.detail||"";
  document.getElementById("threadCreator").textContent =
    `ä½œæˆè€…: ${data.memberId} ${formatDate(data.created_at)}`;

  document.getElementById("threadListSection").style.display="none";
  document.getElementById("threadDetailSection").style.display="block";

  loadPosts(id);
}

/* æŠ•ç¨¿èª­ã¿è¾¼ã¿ */
function loadPosts(threadId){
  const list = document.getElementById("postList");
  list.innerHTML="";

  if(postsUnsub) postsUnsub();

  const q = query(collection(db,"threads",threadId,"posts"), orderBy("created_at","asc"));

  postsUnsub = onSnapshot(q, snap=>{
    list.innerHTML="";
    let idx=1;

    snap.forEach(p=>{
      const data = p.data();
      const li = document.createElement("li");
      li.style.backgroundColor = data.color;

      li.innerHTML = `#${idx} <strong>${data.memberId}</strong>: ${(data.body||"").replace(/\n/g,"<br>")}`;

      const small = document.createElement("small");
      small.textContent = formatRelativeTime(data.created_at);
      li.appendChild(small);

      if(data.image){
        const btn = document.createElement("button");
        btn.className = "greenBtn";
        btn.textContent = "ç”»åƒã‚’è¡¨ç¤º";
        btn.onclick = ()=>showImagePopup(data.image);
        li.appendChild(btn);
      }

      list.appendChild(li);
      idx++;
    });

    /* æœ€æ–°æŠ•ç¨¿æ™‚åˆ»æ›´æ–° */
    if(snap.size>0){
      const last = snap.docs[snap.docs.length-1].data();
      updateDoc(doc(db,"threads",threadId),{
        lastPost_at: last.created_at
      });
    }
  });
}

/* ç”»åƒãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
function showImagePopup(src){
  document.getElementById("popupImage").src=src;
  document.getElementById("imagePopup").style.display="block";
}
document.getElementById("closeImagePopup").onclick = ()=>{
  document.getElementById("imagePopup").style.display="none";
};

/* æŠ•ç¨¿ä½œæˆ */
document.getElementById("createPostBtn").onclick = ()=>{
  showForm("postFields");
  document.getElementById("popupTitle").textContent = "æŠ•ç¨¿";

  document.getElementById("submitBtn").onclick = async ()=>{
    let name = document.getElementById("postMemberId").value.trim();
    if(name){ nickName=name; setCookie("nickName",nickName); }

    const body = document.getElementById("postBodyInput").value.trim();
    if(containsNGWord(body)) return alert("ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™");

    const imgF = document.getElementById("postImageInput").files[0];
    const img = imgF ? await fileToBase64(imgF) : null;

    const color = document.getElementById("postColorInput").value;

    if(!body && !img) return alert("æœ¬æ–‡ã¾ãŸã¯ç”»åƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

    await addDoc(collection(db,"threads",currentThreadId,"posts"),{
      memberId: nickName,
      icon: iconBase64,
      body,
      image: img,
      color,
      created_at: Timestamp.now()
    });

    await updateDoc(doc(db,"threads",currentThreadId),{
      lastPost_at: Timestamp.now()
    });

    closePopup();
  };
};

/* ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆ */
document.getElementById("createThreadBtn").onclick = ()=>{
  showForm("threadFields");
  document.getElementById("popupTitle").textContent = "æ–°è¦ã‚¹ãƒ¬ãƒƒãƒ‰";

  document.getElementById("submitBtn").onclick = async ()=>{
    let name = document.getElementById("threadMemberId").value.trim();
    if(name) nickName=name;

    const title = document.getElementById("threadTitleInput").value.trim();
    const detail= document.getElementById("threadDetailInput").value.trim();
    if(containsNGWord(title)||containsNGWord(detail))
      return alert("ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™");

    const imgF = document.getElementById("threadImageInput").files[0];
    const img = imgF ? await fileToBase64(imgF) : null;

    const color = document.getElementById("threadColorInput").value;
    const pass  = document.getElementById("threadPasswordInput").value.trim();

    if(!title) return alert("ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

    await addDoc(collection(db,"threads"),{
      memberId: nickName,
      icon: iconBase64,
      title,
      detail,
      image: img,
      color,
      password: pass||null,
      created_at: Timestamp.now(),
      likes: 0,
      dislikes: 0,
      lastPost_at: null
    });

    closePopup();
  };
};

/* ç®¡ç†è€…æ“ä½œ */
document.getElementById("adminBtn").onclick = async ()=>{
  showForm("adminFields");
  document.getElementById("popupTitle").textContent = "ç®¡ç†è€…æ“ä½œ";

  const snap = await getDocs(collection(db,"threads"));
  const sel = document.getElementById("adminThreadSelect");
  sel.innerHTML = "<option value=''>ã‚¹ãƒ¬ãƒƒãƒ‰é¸æŠ</option>";

  snap.forEach(d=>{
    const opt=document.createElement("option");
    opt.value=d.id;
    opt.textContent=d.data().title;
    sel.appendChild(opt);
  });

  sel.onchange = async ()=>{
    const tid = sel.value;
    const postSel = document.getElementById("adminPostSelect");
    postSel.innerHTML = "<option value=''>æŠ•ç¨¿é¸æŠ</option>";
    if(tid){
      const ps = await getDocs(collection(db,"threads",tid,"posts"));
      ps.forEach(p=>{
        const opt=document.createElement("option");
        opt.value=p.id;
        opt.textContent=(p.data().body||"[ç”»åƒ]")?.slice(0,10);
        postSel.appendChild(opt);
      });
    }
  };

  document.getElementById("submitBtn").onclick = async ()=>{
    const pass = document.getElementById("adminPasswordInput").value;
    if(pass!==ADMIN_PASSWORD) return alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é•ã„");

    const mode = document.querySelector("input[name='adminAction']:checked").value;
    const tid  = document.getElementById("adminThreadSelect").value;
    const pid  = document.getElementById("adminPostSelect").value;

    if(mode==="single" && tid){
      await deleteDoc(doc(db,"threads",tid));
    }
    if(mode==="post" && tid && pid){
      await deleteDoc(doc(db,"threads",tid,"posts",pid));
    }
    if(mode==="lock" && tid){
      await updateDoc(doc(db,"threads",tid),{locked:true});
    }
    if(mode==="unlock" && tid){
      await updateDoc(doc(db,"threads",tid),{locked:false});
    }
    if(mode==="all"){
      const all=await getDocs(collection(db,"threads"));
      for(const d of all.docs) await deleteDoc(doc(db,"threads",d.id));
    }

    closePopup();
  };
};

/* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ“ä½œ */
function showForm(id){
  ["threadFields","postFields","adminFields","passwordFields"].forEach(e=>{
    document.getElementById(e).style.display="none";
  });
  document.getElementById(id).style.display="block";
  document.getElementById("popupForm").style.display="block";
  document.getElementById("overlay").style.display="block";
}

function closePopup(){
  document.getElementById("popupForm").style.display="none";
  document.getElementById("overlay").style.display="none";
}

document.getElementById("closePopupBtn").onclick = closePopup;

/* ç”»åƒã‚’base64ã¸ */
function fileToBase64(file){
  return new Promise(res=>{
    const r=new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });
}

/* ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§ã®æˆ»ã‚‹ */
document.getElementById("closeThreadBtn").onclick = ()=>{
  if(postsUnsub) postsUnsub();
  document.getElementById("threadDetailSection").style.display="none";
  document.getElementById("threadListSection").style.display="block";
};

/* åˆæœŸèµ·å‹• */
listenThreads();
</script>
</body>
</html>
